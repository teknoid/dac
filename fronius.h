#define CHUNK_SIZE 		2048

#define	HEATERS			"plug9"
#define HEATER_WATT		600

#define BOILERS			"boiler1", "boiler2", "boiler3"
#define BOILER_WATT		2000
#define BOILER_STANDBY	20

// Fronius API is slow --> timings <5s make no sense
#define WAIT_OFFLINE	900
#define WAIT_STANDBY	300
#define WAIT_KEEP		30
#define WAIT_RAMPUP		5
#define WAIT_RAMPDOWN	5

#define STANDBY_EXPIRE	3600 / WAIT_STANDBY

#define PV_HISTORY		16

#define PHASE_ANGLES_BOILER1 \
0, 2340, 2350, 2370, 2410, 2450, 2510, 2560, 2620, 2660, 2710, \
2760, 2800, 2840, 2880, 2920, 2950, 2990, 3030, 3060, 3100, \
3140, 3170, 3210, 3250, 3270, 3310, 3350, 3380, 3420, 3440, \
3490, 3530, 3550, 3600, 3640, 3680, 3700, 3740, 3780, 3810, \
3860, 3900, 3940, 3970, 4030, 4070, 4110, 4150, 4200, 4240, \
4280, 4330, 4380, 4420, 4480, 4530, 4590, 4660, 4740, 4800, \
4850, 4890, 4950, 5010, 5060, 5120, 5180, 5240, 5310, 5380, \
5440, 5510, 5580, 5640, 5710, 5790, 5880, 5960, 6070, 6190, \
6320, 6490, 6620, 6700, 6780, 6920, 7050, 7260, 7400, 7550, \
7780, 8190, 8490, 9850, 9930, 9999, 9999, 9999, 9999, 10000

#define PHASE_ANGLES_BOILER2 \
0, 2760, 2900, 3010, 3080, 3140, 3200, 3250, 3300, 3350, 3400, \
3450, 3500, 3550, 3580, 3620, 3660, 3700, 3750, 3780, 3820, \
3870, 3890, 3940, 3980, 4010, 4050, 4080, 4110, 4150, 4190, \
4220, 4260, 4300, 4330, 4380, 4420, 4460, 4490, 4520, 4570, \
4610, 4640, 4680, 4730, 4780, 4810, 4860, 4900, 4930, 4980, \
5040, 5080, 5120, 5180, 5220, 5280, 5320, 5370, 5400, 5450, \
5530, 5590, 5630, 5670, 5740, 5770, 5850, 5910, 5970, 6030, \
6090, 6140, 6220, 6290, 6370, 6420, 6500, 6560, 6630, 6710, \
6780, 6900, 6980, 7090, 7200, 7310, 7440, 7600, 7780, 7900, \
8080, 8240, 8410, 8960, 9390, 9900, 9960, 9999, 9999, 10000

#define PHASE_ANGLES_BOILER3 \
0, 2470, 2600, 2710, 2790, 2850, 2910, 2970, 3010, 3060, 3110, \
3160, 3200, 3230, 3280, 3330, 3360, 3390, 3430, 3460, 3490, \
3530, 3570, 3600, 3640, 3660, 3700, 3740, 3770, 3800, 3840, \
3860, 3910, 3940, 3970, 4010, 4030, 4070, 4110, 4140, 4170, \
4190, 4230, 4280, 4300, 4350, 4390, 4440, 4480, 4520, 4560, \
4600, 4650, 4700, 4730, 4780, 4820, 4880, 4930, 4960, 5030, \
5070, 5130, 5160, 5210, 5290, 5330, 5360, 5440, 5480, 5550, \
5610, 5660, 5690, 5770, 5840, 5900, 5960, 6040, 6090, 6170, \
6260, 6320, 6390, 6500, 6600, 6670, 6800, 6900, 7020, 7140, \
7300, 7430, 7570, 7680, 7850, 8940, 9750, 9800, 9900, 10000

#define PHASE_ANGLES_BOILERXX \
0, 2370, 2380, 2400, 2425, 2450, 2475, 2500, 2533, 2566, 2600,\
2640, 2680, 2720, 2760, 2800, 2840, 2880, 2920, 2960, 3000,\
3040, 3080, 3120, 3160, 3200, 3240, 3280, 3320, 3360, 3400,\
3445, 3490, 3535, 3580, 3625, 3670, 3715, 3760, 3805, 3850,\
3900, 3950, 4000, 4050, 4100, 4150, 4200, 4250, 4300, 4350,\
4405, 4460, 4515, 4570, 4625, 4680, 4735, 4790, 4845, 4900,\
4960, 5020, 5080, 5140, 5200, 5260, 5320, 5380, 5440, 5500,\
5565, 5630, 5695, 5760, 5825, 5890, 5955, 6020, 6085, 6150,\
6220, 6290, 6360, 6430, 6500, 6570, 6640, 6710, 6780, 6860,\
6950, 7050, 7150, 7350, 7550, 7800, 8100, 8400, 8800, 10000

#define PHASE_ANGLES_BOILER2_600 \
0, 2395, 2524, 2693, 2845, 2980, 3098, 3199, 3283, 3350, 3400,\
3440, 3480, 3520, 3560, 3600, 3640, 3680, 3720, 3760, 3800,\
3835, 3870, 3905, 3940, 3975, 4010, 4045, 4080, 4115, 4150,\
4185, 4220, 4255, 4290, 4325, 4360, 4395, 4430, 4465, 4500,\
4540, 4580, 4620, 4660, 4700, 4740, 4780, 4820, 4860, 4900,\
4945, 4990, 5035, 5080, 5125, 5170, 5215, 5260, 5305, 5350,\
5400, 5450, 5500, 5550, 5600, 5650, 5700, 5750, 5800, 5850,\
5915, 5980, 6045, 6110, 6175, 6240, 6305, 6370, 6435, 6500,\
6580, 6660, 6740, 6820, 6900, 6980, 7060, 7140, 7220, 7300,\
7380, 7450, 7600, 7750, 7900, 8000, 8250, 8500, 8800, 10000

#define PHASE_ANGLES_BOILER2_2000 \
0, 2750, 2875, 2975, 3075, 3150, 3225, 3300, 3350, 3400, 3450,\
3500, 3550, 3600, 3650, 3700, 3750, 3800, 3850, 3900, 3950,\
3980, 4010, 4040, 4070, 4100, 4130, 4160, 4190, 4220, 4250,\
4290, 4330, 4370, 4410, 4450, 4490, 4530, 4570, 4610, 4650,\
4690, 4730, 4770, 4810, 4850, 4890, 4930, 4970, 5010, 5050,\
5095, 5140, 5185, 5230, 5275, 5320, 5365, 5410, 5455, 5500,\
5550, 5600, 5650, 5700, 5750, 5800, 5850, 5900, 5950, 6000,\
6050, 6100, 6150, 6200, 6250, 6300, 6350, 6400, 6450, 6500,\
6580, 6660, 6740, 6820, 6900, 6980, 7060, 7140, 7220, 7300,\
7380, 7450, 7600, 7750, 7900, 8000, 8250, 8500, 8800, 10000

#define URL_METER			"http://fronius/solar_api/v1/GetMeterRealtimeData.cgi?Scope=Device&DeviceId=0"
#define URL_FLOW			"http://fronius/solar_api/v1/GetPowerFlowRealtimeData.fcgi"

typedef struct get_response_t {
	char *buffer;
	size_t len;
	size_t buflen;
} get_response_t;

typedef struct device_t {
	const char *name;
	const char *addr;
	unsigned const int *phase_angle;
	int active;
	int override;
	int power;
} device_t;

void fronius_override(int index);
